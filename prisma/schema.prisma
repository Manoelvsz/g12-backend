generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String     @id @default(uuid())
  name      String
  email     String     @unique
  address   String?
  avatar    String?
  birthDate DateTime?
  createdAt DateTime   @default(now())
  password  String
  phone     String?
  updatedAt DateTime   @updatedAt
  userRoles UserRole[]
}

model Role {
  id          String     @id @default(uuid())
  name        String     @unique
  label       String
  description String?
  hierarchy   Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  userRoles   UserRole[]
}

model UserRole {
  id         String   @id @default(uuid())
  userId     String
  roleId     String
  assignedBy String?
  assignedAt DateTime @default(now())
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
}

model Post {
  id        String   @id @default(uuid())
  title     String?
  content   String
  imageUrl  String?
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("posts")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cells {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  neighborhood_id String        @db.Uuid
  cep             String?
  address         String?
  leader          String?
  generation      String?
  network         String?
  latitude        Decimal?      @db.Decimal(10, 8)
  longitude       Decimal?      @db.Decimal(11, 8)
  created_at      DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?     @default(now()) @db.Timestamptz(6)
  neighborhoods   neighborhoods @relation(fields: [neighborhood_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([name, neighborhood_id])
  @@index([latitude, longitude], map: "idx_cells_coordinates")
  @@index([name], map: "idx_cells_name")
  @@index([neighborhood_id], map: "idx_cells_neighborhood_id")
}

model CellRequest {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cep             String
  address         String?
  name            String?
  latitude        Decimal   @db.Decimal(10, 8)
  longitude       Decimal   @db.Decimal(11, 8)
  neighborhood_id String?   @db.Uuid
  network         String?
  notes           String?
  status          String    @default("pending")
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@map("cell_requests")
  @@index([status], map: "idx_cell_requests_status")
  @@index([neighborhood_id], map: "idx_cell_requests_neighborhood")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model neighborhoods {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String
  city       String    @default("Salvador")
  state      String    @default("BA")
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  cells      cells[]

  @@unique([name, city, state])
  @@index([city, state], map: "idx_neighborhoods_city_state")
  @@index([name], map: "idx_neighborhoods_name")
}
